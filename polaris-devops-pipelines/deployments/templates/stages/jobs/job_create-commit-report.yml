  ﻿---
  parameters:
    - name: targetLabel
      type: string
    - name: targetLabelLower
      type: string
    - name: jobDependsOn
      type: object
  
  jobs:
    - job: CreateCommitReport
      dependsOn: ${{ parameters.jobDependsOn }}
      steps:
        - checkout: self
          persistCredentials: true

        - task: PowerShell@2
          inputs:
            targetType: 'inline'
            script: |
              $targetLabel = "${{ parameters.targetLabel }}"
              $lowercaseTargetLabel = $targetLabel.ToLower()
              git log $lowercaseTargetLabel...HEAD --oneline --pretty=format:%h,%an,%ae,%s > commit-report-$lowercaseTargetLabel.csv
          displayName: Generate commit report for ${{ parameters.targetLabel }}

        - task: PublishPipelineArtifact@1
          inputs:
            targetPath: "$(Build.Repository.LocalPath)/commit-report-${{ parameters.targetLabelLower }}.csv"
            artifact: "Commit Report - ${{ parameters.targetLabel }} ($(System.JobAttempt))"
          displayName: "Publish Commit report for ${{ parameters.targetLabel }}"